1ï¸âƒ£ Â¿QuÃ© vulnerabilidades de seguridad previenen las cookies HttpOnly que localStorage no puede prevenir?

Las cookies HttpOnly evitan que el token de autenticaciÃ³n sea accesible desde JavaScript. Esto es importante porque previenen ataques XSS, donde un atacante inyecta cÃ³digo malicioso en la pÃ¡gina para robar informaciÃ³n.

En cambio, localStorage sÃ­ puede ser leÃ­do por JavaScript, por lo que si ocurre un ataque XSS, el token puede ser robado fÃ¡cilmente.

ğŸ” AnalogÃ­a:
Es como guardar una llave importante:

En localStorage, la dejo sobre la mesa, cualquiera que entre puede tomarla.

En una cookie HttpOnly, la guardo en una caja fuerte que solo el navegador puede usar.

Por eso, las cookies HttpOnly ofrecen mayor seguridad para autenticaciÃ³n.

2ï¸âƒ£ Â¿Por quÃ© es importante el atributo sameSite: 'strict' en las cookies?

Â¿QuÃ© es un ataque CSRF y cÃ³mo lo previene este atributo?

El atributo sameSite: 'strict' hace que la cookie solo se envÃ­e cuando la peticiÃ³n proviene del mismo sitio web. Esto es clave para prevenir ataques CSRF.

Un ataque CSRF ocurre cuando una pÃ¡gina maliciosa engaÃ±a al navegador del usuario para enviar una peticiÃ³n a un sitio donde ya estÃ¡ autenticado, sin que el usuario lo sepa.

ğŸ” AnalogÃ­a:
Es como si alguien intentara usar mi tarjeta bancaria desde otro lugar sin mi permiso.
Con sameSite: 'strict', el banco solo acepta operaciones si vienen directamente desde su propia aplicaciÃ³n.

Esto evita que peticiones externas usen mi sesiÃ³n.

3ï¸âƒ£ Â¿En quÃ© escenarios NO serÃ­a recomendable usar cookies para autenticaciÃ³n?

No es recomendable usar cookies cuando se trabaja con:

Aplicaciones mÃ³viles

APIs pÃºblicas

Microservicios

Servicios que no dependen del navegador

Esto se debe a que las cookies dependen de polÃ­ticas del navegador, mientras que en estos casos es mÃ¡s prÃ¡ctico usar tokens enviados manualmente en los headers.

ğŸ”¹ TÃ©cnicas
4ï¸âƒ£ Â¿QuÃ© pasarÃ­a si olvido agregar credentials: 'include' en fetch?

Si no agrego credentials: 'include', el navegador no enviarÃ¡ las cookies al backend.
Como resultado, el servidor no reconocerÃ¡ al usuario como autenticado.

ğŸ”¬ Al experimentar:
Al eliminar esta opciÃ³n, el login parecÃ­a funcionar, pero al acceder a rutas protegidas el sistema respondÃ­a como si no estuviera logueado.

5ï¸âƒ£ Â¿Por quÃ© necesitamos configurar CORS con credentials: true en el backend?

Porque el navegador, por seguridad, bloquea el envÃ­o de cookies entre dominios diferentes.
Al usar credentials: true, le indicamos que permitimos el intercambio de cookies entre el frontend y el backend.

Esto estÃ¡ relacionado con la polÃ­tica de mismo origen (Same-Origin Policy) del navegador.

6ï¸âƒ£ Â¿CÃ³mo afecta el uso de cookies si frontend y backend estÃ¡n en dominios distintos?

Cuando frontend y backend estÃ¡n en dominios diferentes, las cookies pueden ser consideradas cookies de terceros, las cuales muchos navegadores bloquean.

Esto obliga a:

Usar HTTPS

Configurar correctamente SameSite

Considerar otras alternativas como tokens en headers

ğŸ”¹ Casos PrÃ¡cticos
7ï¸âƒ£ ImplementaciÃ³n del mecanismo â€œRecordarmeâ€

Â¿CÃ³mo modificarÃ­a maxAge?
AumentarÃ­a el tiempo de vida de la cookie, por ejemplo, a varios dÃ­as o semanas.

Â¿QuÃ© consideraciones de seguridad tendrÃ­a?

Limitar el tiempo mÃ¡ximo

Permitir cerrar sesiÃ³n manualmente

Renovar el token periÃ³dicamente

Invalidar la cookie si se detecta actividad sospechosa

8ï¸âƒ£ Manejo de la expiraciÃ³n del token

Experiencia de usuario:
MostrarÃ­a un mensaje claro indicando que la sesiÃ³n expirÃ³ y pedirÃ­a volver a iniciar sesiÃ³n.

Mantener el contexto:
GuardarÃ­a la pÃ¡gina donde estaba el usuario antes de redirigirlo al login, para devolverlo al mismo lugar despuÃ©s de autenticarse.

ğŸ”¹ Debugging
9ï¸âƒ£ Error: Cannot set headers after they are sent to the client

Este error puede ocurrir cuando intento enviar una respuesta mÃ¡s de una vez, por ejemplo, usando res.json() antes de res.cookie().

El orden correcto es:

Establecer la cookie

Enviar la respuesta

ğŸ”Ÿ Las cookies no se guardan en el navegador

Posibles causas:

1ï¸âƒ£ No usar credentials: 'include'
2ï¸âƒ£ CORS mal configurado
3ï¸âƒ£ Atributos incorrectos en la cookie (sameSite, secure)

Cada una se puede verificar revisando el cÃ³digo y usando las herramientas del navegador.

ğŸ”¹ Arquitectura
1ï¸âƒ£1ï¸âƒ£ ComparaciÃ³n: localStorage vs Cookies
Criterio	Cookies	localStorage
Acceso por JS	No (HttpOnly)	SÃ­
Seguridad XSS	Alta	Baja
EnvÃ­o automÃ¡tico	SÃ­	No
Control del servidor	Alto	Bajo
Uso ideal	AutenticaciÃ³n	Preferencias

Uso recomendado:

Cookies para autenticaciÃ³n

localStorage para configuraciones visuales o datos no sensibles

1ï¸âƒ£2ï¸âƒ£ Estrategia de migraciÃ³n en producciÃ³n

Para migrar una aplicaciÃ³n sin afectar a los usuarios activos:

MantendrÃ­a ambos mÃ©todos temporalmente

MigrarÃ­a usuarios nuevos al nuevo sistema

ForzarÃ­a reautenticaciÃ³n gradual

MonitorearÃ­a errores y sesiones

Rollback:
MantendrÃ­a compatibilidad con el sistema anterior y activarÃ­a una reversiÃ³n rÃ¡pida si aparecen problemas.